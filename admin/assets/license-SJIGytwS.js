import{r as y,d as N,c as k,g as w,l as p,a as u,b as H,n as x,q as L,i as E,j as o,k as C,p as F,t as I,s as A,u as R,o as S,e as f}from"./common-C51FUouZ.js";/* empty css              */const a=n=>document.getElementById(n);window.addEventListener("load",()=>{B(),a("btn-random-tls").onclick=()=>{a("l-tls").value=y()}});function B(){const n=a("wallet-buttons");setTimeout(()=>{const r=N();if(r.length===0){n.innerHTML='<span style="color:var(--dim)">No Solana wallet detected. Install Phantom, Solflare, or Backpack.</span>';return}n.innerHTML="";for(const t of r){const e=document.createElement("button");e.textContent=`Connect ${t.name}`,e.className="btn-outline",e.style.marginRight="8px",e.onclick=()=>P(t.provider,t.name),n.appendChild(e)}},500)}async function P(n,r){try{await k(n);const t=w();a("wallet-buttons").innerHTML=`<span class="badge badge-ok">Connected: ${r}</span>`,a("wallet-info").classList.remove("hidden"),a("w-addr").textContent=t.toBase58();const e=p(),s=u(e.rpc),i=await H(s,t,e.masterNftMint);a("w-nft").innerHTML=i?'<span class="badge badge-ok">✓ You hold the Master NFT</span>':'<span class="badge badge-fail">✗ Not the Master NFT holder — edition printing requires Master NFT</span>',a("btn-issue-license").disabled=!i,await M(),await T()}catch(t){a("wallet-buttons").innerHTML=`<span class="badge badge-fail">Error: ${t.message}</span>`}}async function M(){const n=p(),r=u(n.rpc),t=a("l-reseller");try{const e=await x(r,n.programId);if(t.innerHTML="",e.length===0){t.innerHTML='<option value="">— No resellers found (create one in Foundation Admin) —</option>';return}for(const s of e){if(s.status!==0)continue;const i=document.createElement("option");i.value=s.resellerNftMint,i.textContent=`${s.name} (${s.territory}) — ${s.licensesIssued}/${s.issuanceLimit} issued — ${L(s.resellerNftMint)}`,t.appendChild(i)}t.options.length===0&&(t.innerHTML='<option value="">— No active resellers —</option>')}catch(e){t.innerHTML=`<option value="">Error: ${e.message}</option>`}}a("btn-issue-license").onclick=async()=>{const n=p(),r=u(n.rpc),t=w(),e=a("license-log");e.classList.remove("hidden"),E(e);const s=a("l-reseller").value,i=a("l-domain").value.trim(),g=parseInt(a("l-threshold").value)||2,m=a("l-tls").value.trim().replace(/\s/g,""),h=a("l-install-url").value.trim(),b=a("l-owner").value.trim()||t.toBase58();if(!s){o(e,"Select a reseller","error");return}if(!i){o(e,"Domain is required","error");return}if(!m||m.length<64){o(e,"TLS fingerprint must be 64 hex chars (32 bytes). Use Random for testing.","error");return}if(!h){o(e,"Install URL is required","error");return}const l=a("btn-issue-license");l.disabled=!0,l.innerHTML='Printing edition…<span class="spinner"></span>';try{o(e,"Step 1/2: Printing Metaplex Edition from Master NFT…");const c=C(n.rpc),d=await F(c,n.masterNftMint);o(e,`Edition minted! Mint: ${d.mint} (edition #${d.editionNumber})`,"ok"),o(e,"Step 2/2: Activating License on-chain…"),l.innerHTML='Activating license…<span class="spinner"></span>';const $=await I(n,t,d.mint,s,b,i,g,m,h),v=await A(r,[$]);o(e,`✓ License activated! TX: ${v}`,"ok"),o(e,`  NFT Mint:    ${d.mint}`,"ok"),o(e,`  Domain:      ${i}`,"ok"),o(e,`  Threshold:   ${g}`,"ok"),o(e,`  Install URL: ${h}`,"ok"),o(e,`  Owner:       ${b}`,"ok"),o(e,`  Reseller:    ${L(s)}`,"ok"),await M(),await T()}catch(c){o(e,`Error: ${c.message}`,"error"),console.error(c)}finally{l.disabled=!1,l.textContent="Print Edition + Activate License"}};async function T(){const n=p(),r=u(n.rpc),t=a("licenses-table");try{const e=await R(r,n.programId);if(e.length===0){t.innerHTML='<span style="color:var(--dim)">No licenses found.</span>';return}t.innerHTML=`
      <table>
        <thead>
          <tr><th>Domain</th><th>Threshold</th><th>Status</th><th>License NFT</th><th>Reseller NFT</th><th>Owner</th></tr>
        </thead>
        <tbody>
          ${e.map(s=>`
            <tr>
              <td style="font-family:sans-serif;font-weight:500">${U(s.domain)}</td>
              <td>${s.unlockThreshold}</td>
              <td>${S(s.status)}</td>
              <td>${f(s.licenseNftMint)}</td>
              <td>${f(s.resellerNftMint)}</td>
              <td>${f(s.owner)}</td>
            </tr>
          `).join("")}
        </tbody>
      </table>
      <p style="color:var(--dim);font-size:0.8rem;margin-top:8px">Total: ${e.length} license(s)</p>`}catch(e){t.innerHTML=`<span class="badge badge-fail">Error: ${e.message}</span>`}}function U(n){const r=document.createElement("span");return r.textContent=n,r.innerHTML}
