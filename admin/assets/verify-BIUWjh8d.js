import{l as V,C as B,i as j,j as d,P as O,v as U,w as q,x as k,y as I,z as C,q as l,A as G,B as J,D as Q,f as W,E as D,o as H,F as X,e as p}from"./common-C51FUouZ.js";/* empty css              */const c=n=>document.getElementById(n);c("btn-verify").onclick=Y;async function Y(){const n=V(),r=new B(n.rpc,"confirmed"),s=c("verify-log");s.classList.remove("hidden"),j(s),c("results").classList.add("hidden");const u=c("v-mint").value.trim();if(!u){d(s,"Enter a License NFT mint address","error");return}let N;try{N=new O(u)}catch{d(s,"Invalid public key","error");return}const g=c("btn-verify");g.disabled=!0,g.innerHTML='Verifying‚Ä¶<span class="spinner"></span>';const f=[];function t(m,v,e){f.push({name:m,pass:v,detail:e}),d(s,`${v?"‚úì":"‚úó"} ${m}: ${e}`,v?"ok":"error")}try{d(s,"1. Fetching License Entry PDA‚Ä¶");const m=U(n.programId,u),v=await r.getAccountInfo(m);if(!v)throw t("License PDA",!1,`Not found at ${m.toBase58()}`),new Error("License Entry not found on-chain");const e=q(v.data);t("License PDA",!0,`${m.toBase58()} (domain: ${e.domain})`),t("License Status",e.status===0,k(e.status)),t("License NFT Match",e.licenseNftMint===u,"Stored mint matches input"),d(s,"2. Fetching Metaplex Edition for License NFT‚Ä¶");const z=I(u),x=await r.getAccountInfo(z);let y=null;x?(y=C(x.data),t("License Edition",y.key===1,`Edition #${y.edition}, parent: ${l(y.parent)}`)):t("License Edition",!1,"Metaplex Edition account not found"),d(s,"3. Fetching Reseller Entry PDA‚Ä¶");const K=G(n.programId,e.resellerNftMint),F=await r.getAccountInfo(K);let i=null;F?(i=J(F.data),t("Reseller PDA",!0,`${i.name} (${i.territory})`),t("Reseller Status",i.status===0,k(i.status))):t("Reseller PDA",!1,`Not found for reseller mint ${l(e.resellerNftMint)}`),d(s,"4. Fetching Metaplex Edition for Reseller NFT‚Ä¶");let M=null;if(i){const a=I(e.resellerNftMint),S=await r.getAccountInfo(a);S?(M=C(S.data),t("Reseller Edition",M.key===1,`Edition #${M.edition}, parent: ${l(M.parent)}`)):t("Reseller Edition",!1,"Metaplex Edition account not found")}d(s,"5. Fetching Master Edition‚Ä¶");const R=I(n.masterNftMint),w=await r.getAccountInfo(R);let h=null;w?(h=Q(w.data),t("Master Edition",h.key===6,`Supply: ${h.supply}, Max: ${h.maxSupply??"Unlimited"}`)):t("Master Edition",!1,"Not found"),d(s,"6. Verifying parent chain‚Ä¶");const E=R.toBase58();if(y){const a=y.parent===E;t("License ‚Üí Master Edition",a,a?"Edition parent points to Master Edition ‚úì":`MISMATCH: parent ${l(y.parent)} ‚â† master ${l(E)}`)}if(M){const a=M.parent===E;t("Reseller ‚Üí Master Edition",a,a?"Edition parent points to Master Edition ‚úì":`MISMATCH: parent ${l(M.parent)} ‚â† master ${l(E)}`)}if(i){const a=i.masterNftMint===n.masterNftMint;t("Reseller ‚Üí Master NFT",a,a?"Reseller references correct Master NFT ‚úì":`MISMATCH: ${l(i.masterNftMint)} ‚â† ${l(n.masterNftMint)}`)}const P=e.masterNftMint===n.masterNftMint;t("License ‚Üí Master NFT",P,P?"License references correct Master NFT ‚úì":`MISMATCH: ${l(e.masterNftMint)} ‚â† ${l(n.masterNftMint)}`),d(s,"7. Fetching License Registry‚Ä¶");const o=await W(r,n.programId,n.masterNftMint);o?t("Registry",!0,`Authority: ${l(o.authority)}, ${o.activeResellers} resellers, ${o.activeLicenses} licenses`):t("Registry",!1,"Not found");const L=f.filter(a=>a.pass).length,T=f.length,b=L===T;c("result-summary").innerHTML=`
      <div style="text-align:center;padding:16px">
        <div style="font-size:2.5rem;margin-bottom:8px">${b?"‚úÖ":"‚ö†Ô∏è"}</div>
        <div style="font-size:1.2rem;font-weight:600;margin-bottom:4px">
          ${b?"LINEAGE VERIFIED":"VERIFICATION ISSUES"}
        </div>
        <div style="color:var(--dim)">${L}/${T} checks passed</div>
        ${e?`<div style="margin-top:8px;font-size:0.9rem">Domain: <strong>${$(e.domain)}</strong></div>`:""}
      </div>
      <table style="margin-top:12px">
        <tbody>
          ${f.map(a=>`
            <tr>
              <td style="width:24px">${a.pass?"‚úÖ":"‚ùå"}</td>
              <td style="font-family:sans-serif;font-weight:500">${a.name}</td>
              <td style="color:var(--dim)">${a.detail}</td>
            </tr>
          `).join("")}
        </tbody>
      </table>`,c("result-license").innerHTML=e?A({"NFT Mint":p(e.licenseNftMint),Domain:$(e.domain),"Install URL":$(e.installUrl),Threshold:e.unlockThreshold,Owner:p(e.owner),Custody:e.custodyMode===0?"Owner":"Squads","Reseller NFT":p(e.resellerNftMint),"Master NFT":p(e.masterNftMint),"Edition #":String(e.editionNumber),"TLS Fingerprint":X(e.tlsCertFingerprint),Keyholders:`${e.activeKeyholders}/${e.totalKeyholders}`,Status:H(e.status),Activated:D(e.activatedAt)}):'<span style="color:var(--dim)">Not found</span>',c("result-edition").innerHTML=Z(y,M,h,E,e,i),c("result-reseller").innerHTML=i?A({"NFT Mint":p(i.resellerNftMint),Name:$(i.name),Territory:$(i.territory),Owner:p(i.owner),Issued:`${i.licensesIssued} / ${i.issuanceLimit}`,Category:i.category||"‚Äî","Edition #":String(i.editionNumber),"Master NFT":p(i.masterNftMint),Status:H(i.status),Activated:D(i.activatedAt)}):'<span style="color:var(--dim)">Not found</span>',c("result-registry").innerHTML=o?A({PDA:p(o.address),Authority:p(o.authority),"Master NFT":p(o.masterNftMint),Resellers:`${o.activeResellers} active / ${o.totalResellers} total`,Licenses:`${o.activeLicenses} active / ${o.totalLicenses} total`,Keyholders:`${o.activeKeyholders} active / ${o.totalKeyholders} total`}):'<span style="color:var(--dim)">Not found</span>',c("results").classList.remove("hidden"),d(s,`
Verification complete: ${L}/${T} checks passed`,b?"ok":"warn")}catch(m){d(s,`Error: ${m.message}`,"error"),console.error(m)}finally{g.disabled=!1,g.textContent="Verify Lineage"}}function A(n){return`<div class="info-grid">${Object.entries(n).map(([r,s])=>`<span class="label">${r}</span><span class="value">${s}</span>`).join("")}</div>`}function Z(n,r,s,u,N,g){const f=[];if(s&&f.push(`<div style="padding:10px;background:rgba(99,102,241,0.1);border-radius:8px;margin-bottom:8px">
      <strong>üèõÔ∏è Master Edition</strong> (supply: ${s.supply})
      <div style="font-size:0.8rem;color:var(--dim);font-family:monospace">${u}</div>
    </div>`),r&&g){const t=r.parent===u;f.push(`<div style="padding:10px;background:rgba(202,138,4,0.08);border-radius:8px;margin-bottom:8px;border-left:3px solid ${t?"var(--ok)":"var(--fail)"}">
      <strong>üè™ Reseller Edition #${r.edition}</strong> ‚Äî ${$(g.name)}
      <div style="font-size:0.8rem;color:var(--dim)">parent ‚Üí ${l(r.parent)} ${t?"‚úì":"‚úó MISMATCH"}</div>
    </div>`)}if(n&&N){const t=n.parent===u;f.push(`<div style="padding:10px;background:rgba(22,163,74,0.08);border-radius:8px;border-left:3px solid ${t?"var(--ok)":"var(--fail)"}">
      <strong>üìú License Edition #${n.edition}</strong> ‚Äî ${$(N.domain)}
      <div style="font-size:0.8rem;color:var(--dim)">parent ‚Üí ${l(n.parent)} ${t?"‚úì":"‚úó MISMATCH"}</div>
    </div>`)}return f.length?f.join(""):'<span style="color:var(--dim)">No edition data</span>'}function $(n){if(!n)return"‚Äî";const r=document.createElement("span");return r.textContent=n,r.innerHTML}
